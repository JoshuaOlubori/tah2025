%%% Document Macros and Extras %%%

% Previously this macro inserted an explicit blank page with the phrase
% "This page intentionally left blank." To avoid inserting blank pages
% during compilation, redefine the blank-page helpers to no-ops. This
% prevents the project from emitting the gray message and removes the
% extra blank pages while preserving callers that expect these commands.
\newcommand\blankpage{\relax}

% Command that will combine a plain page style and a blank one. Make it
% a no-op as well to avoid producing an empty page with text.
\newcommand{\plainblankpage}{\relax}

% Indicates that a writing guide will be displayed.
\newcommand{\guideinfo}[1]{%
    \textcolor{note}{\faInfoCircle\ \textbf{Writing Guidance}}%
    \\[.55em]%
    \noindent #1%
}
\newcommand{\guiainfo}[1]{%
    \textcolor{note}{\faInfoCircle\ \textbf{Orientação Para a Escrita}}%
    \\[.55em]%
    \noindent #1%
}

% Redefine the underline command.
\setlength{\ULdepth}{1.8pt}\contourlength{1.3pt}
\newcommand{\myuline}[1]{
    \uline{\phantom{#1}}%
    \llap{\contour{white}{#1}}%
}

% Abstract keywords.
\NewDocumentCommand{\keywordsen}{m}{\vspace{.4cm}\noindent\textbf{Keywords:} #1}
\NewDocumentCommand{\keywordspt}{m}{\vspace{.4cm}\noindent\textbf{Palavras-Chave:} #1}

% Landscape mode - the proper way!
\def\ifGm@preamble#1{\@firstofone}
\appto\restoregeometry{%
    \pdfpagewidth=\paperwidth
    \pdfpageheight=\paperheight}
\apptocmd\newgeometry{%
    \pdfpagewidth=\paperwidth
    \pdfpageheight=\paperheight}{}{}
\newenvironment{landscapemode}[2]{%
    \newgeometry{paperwidth=#1,paperheight=#2,hmargin=3cm,vmargin=5cm,top=3cm,landscape}
    \fancyheadoffset{0pt}
    %\titlespacing*{\chapter}{0pt}{0pt}{40pt}
}{%
    \restoregeometry
    \fancyheadoffset{0pt}
}

% Markdown quote block implementation in LaTeX.
\newtcolorbox[auto counter,number within=section]{block}[1][]{
    enhanced jigsaw,
    frame hidden,
    colback=white,
    coltitle=#1,
    fonttitle=\bfseries\itshape,
    sharp corners,
    detach title,
    borderline west={.85mm}{0pt}{#1},
    pad at break=1mm,
    title={\ifstrequal{#1}{todo}{To-Do}{\capitalisewords{#1}}},
    code={\ifdefempty{\tcbtitletext}{}{\tcbset{before upper={\tcbtitle\par\medskip}}}}
}

% Capitalise the first letter in '\autoref' for both English and Portuguese.
\addto\extrasenglish{\def\figureautorefname{Figure}}
\addto\extrasenglish{\def\chapterautorefname{Chapter}}
\addto\extrasenglish{\def\sectionautorefname{Section}}
\addto\extrasenglish{\def\subsectionautorefname{Section}}
\addto\extrasenglish{\def\subsubsectionautorefname{Section}}
\addto\extrasenglish{\def\tableautorefname{Table}}
\addto\extrasenglish{\def\partautorefname{Part}}
\addto\extrasenglish{\def\appendixautorefname{Appendix}}
\addto\extrasportuguese{\def\sectionautorefname{Secção}}
\addto\extrasportuguese{\def\subsectionautorefname{Secção}}
\addto\extrasportuguese{\def\subsubsectionautorefname{Secção}}

% Command to overwrite the color of a given command.
\newcommand{\overwritecolor}[2]{%
    \textcolor{#1}{%
        \renewcommand\color[2][]{}%
    #2}%
}

% Wrapping bot glossary and acronyms commands.
\newcommand{\printnormalglossary}{\printglossary}
\newcommand{\printacronymglossary}{\printglossary[type=\acronymtype]}

% Logic to add or omit a blank page depending on the '\MediaOption' value.
% Silence media-option driven blank pages: make these logic macros
% no-ops so appended/prepended calls (e.g., to \tableofcontents) no
% longer inject blank pages. If you prefer to keep page breaks but not
% the text, change these to use \clearpage instead of \relax.
\newcommand{\MediaOptionLogic}{\relax}
\newcommand{\MediaOptionLogicAcr}{\relax}
\newcommand{\MediaOptionLogicBlank}{\relax}
\newcommand{\MediaOptionLogicAnnexes}{\relax}

% Update various elements based on the '\MediaOption' value.
\apptocmd{\tableofcontents}{\MediaOptionLogic}{}{\fail}
\apptocmd{\listoffigures}{\MediaOptionLogic}{}{\fail}
\apptocmd{\listoftables}{\MediaOptionLogic}{}{\fail}
\apptocmd{\printnormalglossary}{\MediaOptionLogic}{}{\fail}
\apptocmd{\printacronymglossary}{\MediaOptionLogicAcr}{}{\fail}
\pretocmd{\printbibliography}{\MediaOptionLogic}{}{\fail}